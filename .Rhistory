Value.Curated,
Label.Curated)),
by = join_by(FeatureName == FeatureName.Curated))
ValuesADS <- ADS %>%
imap(\(table, tablename) tibble(Table = tablename,
FeatureName = names(table))) %>%
list_rbind()
ValuesADS <- ADS %>%
imap(\(table, tablename) tibble(Table = tablename,
FeatureName = names(table))) %>%
list_rbind() %>%
left_join(select(Meta.Values, c(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated)),
by = join_by(FeatureName == FeatureName.Curated))
?left_join
ValuesADS <- ADS %>%
imap(\(table, tablename) tibble(Table = tablename,
FeatureName = names(table))) %>%
list_rbind() %>%
left_join(select(Meta.Values, c(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated)),
by = join_by(FeatureName == FeatureName.Curated),
relationship = "many-to-many")
View(ValuesADS)
?rename
ValuesADS <- ADS %>%
imap(\(table, tablename) tibble(Table = tablename,
FeatureName = names(table))) %>%
list_rbind()
PrepareCDSValues <- Meta.Values %>%
select(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(IsFeatureFromCDS = TRUE)
ADSValues <- ADS %>%
imap(\(table, tablename) tibble(Table = tablename,
FeatureName = names(table))) %>%
list_rbind()
PrepareCDSValues <- Meta.Values %>%
select(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(IsFeatureFromCDS = TRUE)
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(IsFeatureFromCDS = TRUE)
View(CDSValues)
ADSValues <- ADSValues %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many")
View(ADSValues)
ADSValues <- ADS %>%
imap(\(table, tablename) tibble(Table = tablename,
FeatureName = names(table))) %>%
list_rbind()
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(FeatureIsFromCDS = TRUE)
ADSValues <- ADSValues %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many") %>%
ADSValues.NotFromCDS <- ADSValues %>%
filter(FeatureIsFromCDS)
ADSValues <- ADSValues %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many")
ADSValues.NotFromCDS <- ADSValues %>%
filter(is.na(FeatureIsFromCDS))
View(ADSValues.NotFromCDS)
View(ADSValues.NotFromCDS)
library(usethis)
Meta.ADS <- ADS %>%
imap(\(table, tablename) tibble(Table = tablename,
FeatureName = names(table))) %>%
list_rbind()
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(FeatureIsFromCDS = TRUE)
Meta.ADS <- Meta.ADS %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many")
View(Meta.ADS)
Meta.ADS <- ADS %>%
imap(\(table, tablename) tibble(Table = tablename,
FeatureName = names(table))) %>%
list_rbind()
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(HasEligibleValueSet = TRUE,
FeatureIsFromCDS = TRUE)
Meta.ADS <- Meta.ADS %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many")
use_data(Meta.ADS, overwrite = TRUE)
View(Meta.ADS)
Test <- Meta.ADS %>%
filter(Table == "Events") %>%
pull(FeatureName) %>%
unique()
Test <- Meta.ADS %>%
filter(Table == "Events") %>%
unique(FeatureName)
Test <- Meta.ADS %>%
filter(Table == "Events") %>%
distinct(FeatureName)
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(table, tablename) tibble(TableName = tablename,
FeatureName = names(table))) %>%
list_rbind()
# Get eligible values and labels from CDS features
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(HasEligibleValueSet = TRUE,
FeatureIsFromCDS = TRUE)
# Attach eligible values and labels to ADS features
Meta.ADS <- Meta.ADS %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many")
# Save data in .rda-file and make it part of package
use_data(Meta.ADS, overwrite = TRUE)
View(Meta.ADS)
devtools::load_all(".")
library(dplyr)
library(dsFreda)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(RawDataSet) <- sapply(names(RawDataSet),
function(TableName) { vc_Lookup[TableName] })
RDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "RawDataSet",
Stage.S = "Raw")
RDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "RawDataSet",
Module.S = "CCP",
Stage.S = "Raw")
RDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "RawDataSet",
Module.S = "CCP",
Stage.S = "Raw")
devtools::load_all(".")
library(dplyr)
library(dsFreda)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(RawDataSet) <- sapply(names(RawDataSet),
function(TableName) { vc_Lookup[TableName] })
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Curate data
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
CurationOutput <- CurateDataDS(RawDataSetName.S = "RawDataSet",
Settings.S = list(DataHarmonization = list(Run = TRUE,
Profile = "Default"),
FeatureObligations = list(Profile = "Default"),
FeatureTracking = list(Profile = "Default"),
TableCleaning = list(Run = TRUE)))
RDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "RawDataSet",
Module.S = "CCP",
Stage.S = "Raw")
RDSTableCheck$Diagnosis
CuratedDataSet <- CurationOutput$CuratedDataSet
library(dplyr)
library(dsFreda)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(RawDataSet) <- sapply(names(RawDataSet),
function(TableName) { vc_Lookup[TableName] })
RDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "RawDataSet",
Module.S = "CCP",
Stage.S = "Raw")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Curate data
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
CurationOutput <- CurateDataDS(RawDataSetName.S = "RawDataSet",
Settings.S = list(DataHarmonization = list(Run = TRUE,
Profile = "Default"),
FeatureObligations = list(Profile = "Default"),
FeatureTracking = list(Profile = "Default"),
TableCleaning = list(Run = TRUE)))
CuratedDataSet <- CurationOutput$CuratedDataSet
CDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "CuratedDataSet",
Stage.S = "Curated")
AugmentationOutput <- AugmentDataDS(CuratedDataSetName.S = "CuratedDataSet")
ADSTableCheck <- GetDataSetCheckDS(DataSetName.S = "ADS",
Module.S = "CCP",
Stage.S = "Augmented")
ADS <- AugmentationOutput$AugmentedDataSet
ADSTableCheck <- GetDataSetCheckDS(DataSetName.S = "ADS",
Module.S = "CCP",
Stage.S = "Augmented")
ADSTableCheck <- GetDataSetCheckDS(DataSetName.S = "ADS",
Module.S = "CCP",
Stage.S = "Augmented")
DataSet <- ADS
Module.S <- "CCP"
Stage.S <- "Augmented"
RequiredTableNames.S <- NULL
RequiredFeatureNames.S <- NULL
EligibleValueSets.S <- NULL
Module.S <- "CCP"
Stage.S <- "Augmented"
# --- Argument Validation ---
assert_that(is.string(DataSetName.S))
# Initiate defaults (if no meta data or module name is passed)
if (is.null(RequiredTableNames.S)) { RequiredTableNames.S <- names(DataSet) }
if (is.null(RequiredFeatureNames.S)) { RequiredFeatureNames.S <- list() }
if (is.null(EligibleValueSets.S)) { EligibleValueSets.S <- list() }
# Get package name from 'ModuleRegistration'
ModulePackageName <- dsFreda::ModuleRegistration[[Module.S]]
# Get package-owned module-specific meta data
Meta.ADS.Module <- eval(parse(text = paste0(ModulePackageName, "::Meta.ADS")))
# Get required table names as character vector
RequiredTableNames.S <- Meta.ADS.Module %>%
pull(TableName)
# Get required feature names as list of character vectors (one for each table)
RequiredFeatureNames.S <- RequiredTableNames.S %>%
map(\(tablename) Meta.ADS.Module %>%
filter(TableName == tablename) %>%
pull(FeatureName) %>%
unique()) %>%
set_names(nm = RequiredTableNames.S)
library(purrr)
library(tidyr)
# Get required feature names as list of character vectors (one for each table)
RequiredFeatureNames.S <- RequiredTableNames.S %>%
map(\(tablename) Meta.ADS.Module %>%
filter(TableName == tablename) %>%
pull(FeatureName) %>%
unique()) %>%
set_names(nm = RequiredTableNames.S)
RequiredTableNames.S
# Get required table names as character vector
RequiredTableNames.S <- Meta.ADS.Module %>%
pull(TableName) %>%
unique()
# Get required feature names as list of character vectors (one for each table)
RequiredFeatureNames.S <- RequiredTableNames.S %>%
map(\(tablename) Meta.ADS.Module %>%
filter(TableName == tablename) %>%
pull(FeatureName) %>%
unique()) %>%
set_names(nm = RequiredTableNames.S)
# Get sets of eligible value sets as a list of lists of character vectors
EligibleValueSets.S <- RequiredTableNames.S %>%
map(function(tablename)
{
RelevantFeatures <- Meta.ADS.Module %>%
filter(TableName == tablename,
HasEligibleValueSet == TRUE) %>%
pull(FeatureName) %>%
unique()
ValueSet <- RelevantFeatures %>%
map(\(featurename) Meta.ADS.Module %>%
filter(TableName == tablename,
FeatureName == featurename) %>%
pull(Value)) %>%
set_names(nm = RelevantFeatures)
return(ValueSet)
}) %>%
set_names(nm = RequiredTableNames.S)
# Create Table check templates for all required Data Set tables ("assume as empty/missing")
DataSetCheckTemplate <- RequiredTableNames.S %>%
map(function(tablename)
{
CheckTable(Table = NULL,
RequiredFeatureNames = RequiredFeatureNames.S[[tablename]])
}) %>%
set_names(RequiredTableNames.S)
# Go through actually existing tables in 'DataSet' and check for feature completeness as well as feature types, row counts and rates of non-missing values
DataSetCheckExisting <- DataSet %>%
imap(function(Table, tablename)
{
if (length(Table) > 0 && nrow(Table) > 0)
{
CheckTable(Table = Table,
RequiredFeatureNames = RequiredFeatureNames.S[[tablename]],
EligibleValueSets = EligibleValueSets.S[[tablename]])
}
else { return(NULL) }
}) %>%
compact()      # This removes all NULL elements from list
# Replace info in TableCheckTemplate with info about existing tables to get coherent summary
DataSetCheck <- DataSetCheckTemplate %>%
imap(function(Table, tablename)
{
if (tablename %in% names(DataSetCheckExisting)) { return(DataSetCheckExisting[[tablename]]) }
else { return(Table) }
})
View(DataSetCheck$Therapy$FeatureCheckOverview)
library(dplyr)
library(dsFreda)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(RawDataSet) <- sapply(names(RawDataSet),
function(TableName) { vc_Lookup[TableName] })
RDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "RawDataSet",
Module.S = "CCP",
Stage.S = "Raw")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Curate data
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
CurationOutput <- CurateDataDS(RawDataSetName.S = "RawDataSet",
Settings.S = list(DataHarmonization = list(Run = TRUE,
Profile = "Default"),
FeatureObligations = list(Profile = "Default"),
FeatureTracking = list(Profile = "Default"),
TableCleaning = list(Run = TRUE)))
CuratedDataSet <- CurationOutput$CuratedDataSet
CDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "CuratedDataSet",
Module.S = "CCP",
Stage.S = "Curated")
AugmentationOutput <- AugmentDataDS(CuratedDataSetName.S = "CuratedDataSet")
ADS <- AugmentationOutput$AugmentedDataSet
ADSTableCheck <- GetDataSetCheckDS(DataSetName.S = "ADS",
Module.S = "CCP",
Stage.S = "Augmented")
(ADSTableCheck$Events$FeatureCheckOverview)
View(ADSTableCheck$Events$FeatureCheckOverview)
devtools::load_all(".")
library(dplyr)
library(readxl)
library(usethis)
Set.Privacy <- list(Profile = "loose",     # Optional: 'strict', 'loose'
NThreshold = 5)
# Save data in .rda-file and make it part of package
use_data(Set.Privacy, overwrite = TRUE)
devtools::load_all(".")
library(dplyr)
library(dsFreda)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(RawDataSet) <- sapply(names(RawDataSet),
function(TableName) { vc_Lookup[TableName] })
RDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "RawDataSet",
Module.S = "CCP",
Stage.S = "Raw")
RawDataSet <- DrawSampleDS(RawDataSetName.S = "RawDataSet",
SampleSize.S = 1000)
# --- For Testing Purposes ---
RawDataSetName.S <- "RawDataSet"
SampleSize.S <- 2000
# --- Argument Validation ---
assert_that(is.string(RawDataSetName.S),
is.count(SampleSize.S))
# Get local object: Parse expression and evaluate
RawDataSet <- eval(parse(text = RawDataSetName.S), envir = parent.frame())
AllPatientIDs <- RawDataSet$RDS_Patient$"_id"
AllPatientIDs <- RawDataSet$RDS.Patient$"_id"
AllPatientIDs <- RawDataSet$Patient$"_id"
#AllPatientIDs <- RawDataSet$Patient$PatientID
AvailableNumberPatients <- length(unique(AllPatientIDs))
# Reduce SampleSize.S if necessary
if (SampleSize.S > AvailableNumberPatients) { SampleSize.S <- AvailableNumberPatients }
# Get a random sample of PatientIDs
SampleIDs <- sample(AllPatientIDs,
size = SampleSize.S)
# Subset RDS tables with sampled PatientIDs
RawDataSetSample <- RawDataSet %>%
imap(function(Table, tablename)
{
if (length(Table) > 0 && nrow(Table) > 0)
{
if (tablename == "RDS.Patient") { return(filter(Table, Table$'_id' %in% SampleIDs)) }
else if (tablename %in% c("RDS.GeneralCondition", "RDS.OtherClassification", "RDS.TherapyRecommendation")) { return(filter(Table, Table$PatientID %in% SampleIDs)) }
else { return(filter(Table, Table$'patient-id' %in% SampleIDs)) }
}
else { return(NULL) }
})
# Subset RDS tables with sampled PatientIDs
RawDataSetSample <- RawDataSet %>%
imap(function(Table, tablename)
{
if (length(Table) > 0 && nrow(Table) > 0)
{
if (tablename == "Patient") { return(filter(Table, Table$'_id' %in% SampleIDs)) }
else if (tablename %in% c("GeneralCondition", "OtherClassification", "TherapyRecommendation")) { return(filter(Table, Table$PatientID %in% SampleIDs)) }
else { return(filter(Table, Table$'patient-id' %in% SampleIDs)) }
}
else { return(NULL) }
})
devtools::load_all(".")
RawDataSet <- DrawSampleDS(RawDataSetName.S = "RawDataSet",
SampleSize.S = 1000)
View(Meta.ADS)
View(dsCCPhos::Meta.ADS)
devtools::load_all(".")
library(dplyr)
library(dsFreda)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(RawDataSet) <- sapply(names(RawDataSet),
function(TableName) { vc_Lookup[TableName] })
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Curate data
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
CurationOutput <- CurateDataDS(RawDataSetName.S = "RawDataSet",
Settings.S = list(DataHarmonization = list(Run = TRUE,
Profile = "Default"),
FeatureObligations = list(Profile = "Default"),
FeatureTracking = list(Profile = "Default"),
TableCleaning = list(Run = TRUE)))
CuratedDataSet <- CurationOutput$CuratedDataSet
AugmentationOutput <- AugmentDataDS(CuratedDataSetName.S = "CuratedDataSet")
ADS <- AugmentationOutput$AugmentedDataSet
View(ADS$Diagnosis)
Test <- ADS$Diagnosis
typeof(Test$DiagnosisDate)
?typeof
class(Test$DiagnosisDate)
class(Test$SubDiagnosisID)
class(Test$PatientAgeAtDiagnosis)
class(Test$NumberLymphnodesExamined)
class(Test$HistologyDate)
