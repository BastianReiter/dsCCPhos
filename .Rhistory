library(dplyr)
library(dsFreda)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
CCP.RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(CCP.RawDataSet) <- sapply(names(CCP.RawDataSet),
function(TableName) { vc_Lookup[TableName] })
RDSPreparation <- PrepareRawDataDS(RawDataSetName.S = "CCP.RawDataSet",
Module.S = "CCP",
CurateFeatureNames.S = TRUE)
CCP.RawDataSet <- RDSPreparation$RawDataSet
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Curate data
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
CurationOutput <- CurateDataDS(RawDataSetName.S = "CCP.RawDataSet",
Settings.S = list(DataHarmonization = list(Run = TRUE,
Profile = "Default"),
FeatureObligations = list(Profile = "Default"),
FeatureTracking = list(Profile = "Default"),
TableCleaning = list(Run = TRUE)))
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
CCP.RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(CCP.RawDataSet) <- sapply(names(CCP.RawDataSet),
function(TableName) { vc_Lookup[TableName] })
RDSPreparation <- PrepareRawDataDS(RawDataSetName.S = "CCP.RawDataSet",
Module.S = "CCP",
RunFuzzyStringMatching.S = FALSE,
CurateFeatureNames.S = TRUE)
CCP.RawDataSet <- RDSPreparation$RawDataSet
RDSTableCheck <- dsFreda::GetDataSetCheckDS(DataSetName.S = "CCP.RawDataSet",
Module.S = "CCP",
Stage.S = "Raw")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Curate data
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
CurationOutput <- CurateDataDS(RawDataSetName.S = "CCP.RawDataSet",
Settings.S = list(DataHarmonization = list(Run = TRUE,
Profile = "Default"),
FeatureObligations = list(Profile = "Default"),
FeatureTracking = list(Profile = "Default"),
TableCleaning = list(Run = TRUE)))
CCP.CuratedDataSet <- CurationOutput$CuratedDataSet
AugmentationOutput <- AugmentDataDS(CuratedDataSetName.S = "CCP.CuratedDataSet")
ADS <- AugmentationOutput$AugmentedDataSet
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(Table, tablename) tibble(TableName = tablename,
FeatureName = names(Table),
Type = sapply(Table, class))) %>%
list_rbind()
View(Meta.ADS)
# Get eligible values and labels from CDS features
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
ScaleLevel,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(HasEligibleValueSet = TRUE,
FeatureIsFromCDS = TRUE)
# Attach eligible values and labels to ADS features
Meta.ADS <- Meta.ADS %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many")
View(Meta.ADS)
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(Table, tablename) tibble(TableName = tablename,
FeatureName = names(Table),
Type = sapply(Table, class))) %>%
list_rbind()
# Get eligible values and labels from CDS features
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(HasEligibleValueSet = TRUE,
FeatureIsFromCDS = TRUE)
# Attach eligible values and labels to ADS features
Meta.ADS <- Meta.ADS %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many")
Test <- Meta.ADS %>%
Temp <- Meta.ADS %>%
distinct(TableName, FeatureName, Type)
View(Temp)
# Add feature indicating if feature should be part of an "order list" that can be passed to dsFredaClient::GetExplorationData()
Meta.ADS <- Meta.ADS %>%
mutate(ExploreRoutinely = case_when(TableName == "Events" & FeatureName %in% c("EventClass",
"EventSubclass") ~ TRUE,
TableName == "Diagnosis" & FeatureName %in% c("ICD10Code",
"ICDOTopographyCode",
"LocalizationSide",
"ICDOMorphologyCode",
"Grading",
"UICCStage",
"UICCStageCategory",
"TNM.T",
"TNM.N",
"TNM.M",
"PatientAgeAtDiagnosis",
"TimeDiagnosisToDeath",
"TimeFollowUp") ~ TRUE,
TableName == "Patient" & FeatureName %in% c("Sex",
"LastVitalStatus",
"CausesOfDeath",
"CountDiagnoses") ~ TRUE,
.default = FALSE))
View(Meta.ADS)
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(Table, tablename) tibble(TableName = tablename,
FeatureName = names(Table),
FeatureType = sapply(Table, class))) %>%
list_rbind()
# Get eligible values and labels from CDS features
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(HasEligibleValueSet = TRUE,
FeatureIsFromCDS = TRUE)
# Attach eligible values and labels to ADS features
Meta.ADS <- Meta.ADS %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many")
# Add feature indicating if feature should be part of an "order list" that can be passed to dsFredaClient::GetExplorationData()
Meta.ADS <- Meta.ADS %>%
mutate(ExploreRoutinely = case_when(TableName == "Events" & FeatureName %in% c("EventClass",
"EventSubclass") ~ TRUE,
TableName == "Diagnosis" & FeatureName %in% c("ICD10Code",
"ICDOTopographyCode",
"LocalizationSide",
"ICDOMorphologyCode",
"Grading",
"UICCStage",
"UICCStageCategory",
"TNM.T",
"TNM.N",
"TNM.M",
"PatientAgeAtDiagnosis",
"TimeDiagnosisToDeath",
"TimeFollowUp") ~ TRUE,
TableName == "Patient" & FeatureName %in% c("Sex",
"LastVitalStatus",
"CausesOfDeath",
"CountDiagnoses") ~ TRUE,
.default = FALSE))
library(dplyr)
library(readxl)
library(usethis)
ExcelFilePath <- "./Development/Data/PackageData/PackageDataCCPhos.xlsx"
Sheetnames <- c("Meta.Tables",
"Meta.Features",
"Meta.Values",
"Proc.EventFeatures",
"Proc.TableNormalization",
"Set.FeatureObligations",
"Set.FeatureTracking",
"Set.DataHarmonization",
"Set.TransformativeExpressions",
"Set.Dictionary",
"Set.FuzzyStringMatching",
"Set.DiagnosisRedundancy",
"Set.DiagnosisAssociation")
for (sheetname in Sheetnames)
{
Table <- read_excel(path = ExcelFilePath,
sheet = sheetname,
skip = 2,
col_types = "text")
ColumnTypes <- read_excel(path = ExcelFilePath,
sheet = sheetname,
range = cell_rows(2),
col_names = colnames(Table)) %>%
tidyr::pivot_longer(everything(),
names_to = "Column",
values_to = "Type")
if (nrow(ColumnTypes) > 0)
{
for (i in 1:nrow(ColumnTypes))
{
Table <- Table %>%
mutate(across(all_of(ColumnTypes$Column[i]),
~ dsFreda::FormatData(.x, ColumnTypes$Type[i])))
}
}
assign(x = sheetname,
value = Table)
# Save data in .rda-file and make it part of the package
do.call(use_data, list(as.name(sheetname), overwrite = TRUE))
}
devtools::load_all(".")
library(dplyr)
library(readxl)
library(usethis)
ExcelFilePath <- "./Development/Data/PackageData/PackageDataCCPhos.xlsx"
Sheetnames <- c("Meta.Tables",
"Meta.Features",
"Meta.Values",
"Proc.EventFeatures",
"Proc.TableNormalization",
"Set.FeatureObligations",
"Set.FeatureTracking",
"Set.DataHarmonization",
"Set.TransformativeExpressions",
"Set.Dictionary",
"Set.FuzzyStringMatching",
"Set.DiagnosisRedundancy",
"Set.DiagnosisAssociation")
for (sheetname in Sheetnames)
{
Table <- read_excel(path = ExcelFilePath,
sheet = sheetname,
skip = 2,
col_types = "text")
ColumnTypes <- read_excel(path = ExcelFilePath,
sheet = sheetname,
range = cell_rows(2),
col_names = colnames(Table)) %>%
tidyr::pivot_longer(everything(),
names_to = "Column",
values_to = "Type")
if (nrow(ColumnTypes) > 0)
{
for (i in 1:nrow(ColumnTypes))
{
Table <- Table %>%
mutate(across(all_of(ColumnTypes$Column[i]),
~ dsFreda::FormatData(.x, ColumnTypes$Type[i])))
}
}
assign(x = sheetname,
value = Table)
# Save data in .rda-file and make it part of the package
do.call(use_data, list(as.name(sheetname), overwrite = TRUE))
}
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(Table, tablename) tibble(TableName = tablename,
FeatureName = names(Table),
FeatureType = sapply(Table, class))) %>%
list_rbind()
library(dplyr)
library(dsFreda)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
CCP.RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(CCP.RawDataSet) <- sapply(names(CCP.RawDataSet),
function(TableName) { vc_Lookup[TableName] })
RDSPreparation <- PrepareRawDataDS(RawDataSetName.S = "CCP.RawDataSet",
Module.S = "CCP",
RunFuzzyStringMatching.S = FALSE,
CurateFeatureNames.S = TRUE)
CCP.RawDataSet <- RDSPreparation$RawDataSet
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Curate data
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
CurationOutput <- CurateDataDS(RawDataSetName.S = "CCP.RawDataSet",
Settings.S = list(DataHarmonization = list(Run = TRUE,
Profile = "Default"),
FeatureObligations = list(Profile = "Default"),
FeatureTracking = list(Profile = "Default"),
TableCleaning = list(Run = TRUE)))
CCP.CuratedDataSet <- CurationOutput$CuratedDataSet
AugmentationOutput <- AugmentDataDS(CuratedDataSetName.S = "CCP.CuratedDataSet")
ADS <- AugmentationOutput$AugmentedDataSet
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(Table, tablename) tibble(TableName = tablename,
FeatureName = names(Table),
FeatureType = sapply(Table, class))) %>%
list_rbind()
# Get eligible values and labels from CDS features
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(HasEligibleValueSet = TRUE,
FeatureIsFromCDS = TRUE)
View(CDSValues)
# Attach eligible values and labels to ADS features
Meta.ADS <- Meta.ADS %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many")
View(Meta.ADS)
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(Table, tablename) tibble(TableName = tablename,
FeatureName = names(Table),
FeatureType = sapply(Table, class))) %>%
list_rbind()
# Get eligible values and labels from CDS features
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(HasEligibleValueSet = TRUE,
FeatureIsFromCDS = TRUE)
# Attach eligible values and labels to ADS features
Meta.ADS <- Meta.ADS %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many") %>%
distinct()
# Save data in .rda-file and make it part of package
use_data(Meta.ADS, overwrite = TRUE)
library(dplyr)
library(readxl)
library(usethis)
ExcelFilePath <- "./Development/Data/PackageData/PackageDataCCPhos.xlsx"
Sheetnames <- c("Meta.Tables",
"Meta.Features",
"Meta.Values",
"Proc.EventFeatures",
"Proc.TableNormalization",
"Set.FeatureObligations",
"Set.FeatureTracking",
"Set.DataHarmonization",
"Set.TransformativeExpressions",
"Set.Dictionary",
"Set.FuzzyStringMatching",
"Set.DiagnosisRedundancy",
"Set.DiagnosisAssociation")
for (sheetname in Sheetnames)
{
Table <- read_excel(path = ExcelFilePath,
sheet = sheetname,
skip = 2,
col_types = "text")
ColumnTypes <- read_excel(path = ExcelFilePath,
sheet = sheetname,
range = cell_rows(2),
col_names = colnames(Table)) %>%
tidyr::pivot_longer(everything(),
names_to = "Column",
values_to = "Type")
if (nrow(ColumnTypes) > 0)
{
for (i in 1:nrow(ColumnTypes))
{
Table <- Table %>%
mutate(across(all_of(ColumnTypes$Column[i]),
~ dsFreda::FormatData(.x, ColumnTypes$Type[i])))
}
}
assign(x = sheetname,
value = Table)
# Save data in .rda-file and make it part of the package
do.call(use_data, list(as.name(sheetname), overwrite = TRUE))
}
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(Table, tablename) tibble(TableName = tablename,
FeatureName = names(Table),
FeatureType = sapply(Table, class))) %>%
list_rbind()
library(dplyr)
library(dsFreda)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Load CCP test data as raw data set
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#RawDataSet <- readRDS(file = "./Development/Data/RealData/CCPRealData_Frankfurt.rds")
#OldTestData <- readRDS(file = "./Development/Data/TestData/OldTestData/CCPTestData.rds")
CCP.RawDataSet <- readRDS(file = "./Development/Data/TestData/CCPTestData.rds")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rename tables of RawDataSet (the names are also changed when tables are being loaded into R server sessions)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
vc_Lookup <- dsCCPhos::Meta.Tables$TableName.Curated
names(vc_Lookup) <- dsCCPhos::Meta.Tables$TableName.Raw
names(CCP.RawDataSet) <- sapply(names(CCP.RawDataSet),
function(TableName) { vc_Lookup[TableName] })
RDSPreparation <- PrepareRawDataDS(RawDataSetName.S = "CCP.RawDataSet",
Module.S = "CCP",
RunFuzzyStringMatching.S = FALSE,
CurateFeatureNames.S = TRUE)
CCP.RawDataSet <- RDSPreparation$RawDataSet
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Curate data
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
CurationOutput <- CurateDataDS(RawDataSetName.S = "CCP.RawDataSet",
Settings.S = list(DataHarmonization = list(Run = TRUE,
Profile = "Default"),
FeatureObligations = list(Profile = "Default"),
FeatureTracking = list(Profile = "Default"),
TableCleaning = list(Run = TRUE)))
CCP.CuratedDataSet <- CurationOutput$CuratedDataSet
AugmentationOutput <- AugmentDataDS(CuratedDataSetName.S = "CCP.CuratedDataSet")
ADS <- AugmentationOutput$AugmentedDataSet
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(Table, tablename) tibble(TableName = tablename,
FeatureName = names(Table),
FeatureType = sapply(Table, class))) %>%
list_rbind()
library(purrr)
# Extract table and feature names from ADS tables
Meta.ADS <- ADS %>%
imap(\(Table, tablename) tibble(TableName = tablename,
FeatureName = names(Table),
FeatureType = sapply(Table, class))) %>%
list_rbind()
# Get eligible values and labels from CDS features
CDSValues <- Meta.Values %>%
select(FeatureName.Curated,
Value.Curated,
Label.Curated) %>%
rename(c("FeatureName" = "FeatureName.Curated",
"Value" = "Value.Curated",
"Label" = "Label.Curated")) %>%
mutate(HasEligibleValueSet = TRUE,
FeatureIsFromCDS = TRUE)
View(CDSValues)
# Attach eligible values and labels to ADS features
Meta.ADS <- Meta.ADS %>%
left_join(CDSValues,
by = join_by(FeatureName),
relationship = "many-to-many") %>%
distinct()
# Save data in .rda-file and make it part of package
use_data(Meta.ADS, overwrite = TRUE)
library(devtools)
devtools::install_github("ESCRI11/dsSurvival")
library(dplyr)
library(readxl)
library(usethis)
ExcelFilePath <- "./Development/Data/PackageData/PackageDataCCPhos.xlsx"
Sheetnames <- c("Meta.Tables",
"Meta.Features",
"Meta.Values",
"Proc.EventFeatures",
"Proc.TableNormalization",
"Set.FeatureObligations",
"Set.FeatureTracking",
"Set.DataHarmonization",
"Set.TransformativeExpressions",
"Set.Dictionary",
"Set.FuzzyStringMatching",
"Set.DiagnosisRedundancy",
"Set.DiagnosisAssociation")
for (sheetname in Sheetnames)
{
Table <- read_excel(path = ExcelFilePath,
sheet = sheetname,
skip = 2,
col_types = "text")
ColumnTypes <- read_excel(path = ExcelFilePath,
sheet = sheetname,
range = cell_rows(2),
col_names = colnames(Table)) %>%
tidyr::pivot_longer(everything(),
names_to = "Column",
values_to = "Type")
if (nrow(ColumnTypes) > 0)
{
for (i in 1:nrow(ColumnTypes))
{
Table <- Table %>%
mutate(across(all_of(ColumnTypes$Column[i]),
~ dsFreda::FormatData(.x, ColumnTypes$Type[i])))
}
}
assign(x = sheetname,
value = Table)
# Save data in .rda-file and make it part of the package
do.call(use_data, list(as.name(sheetname), overwrite = TRUE))
}
git add --a
git add --a
